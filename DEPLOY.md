# Деплой и доработка на хостинге

## Где что лежит

- **Клиент и сервер** — один проект Next.js. При деплое на хостинг поднимается один сервер (Node или serverless), который отдаёт страницы и обрабатывает API (`/api/*`).
- **Аутентификация** — часть этого же приложения (NextAuth в API routes). Отдельный бэкенд не нужен.

## Первый запуск на хостинге

1. Установите переменные окружения (см. `.env.example`):
   - `NEXTAUTH_SECRET` — случайная строка (например, `openssl rand -base64 32`).
   - `NEXTAUTH_URL` — полный URL сайта, например `https://yourdomain.com`.

2. При первом запуске **создайте первого администратора**:
   - Откройте в браузере: `https://yourdomain.com/setup`.
   - Заполните логин и пароль, нажмите «Создать».
   - После этого зайдите на `/login` и войдите.

3. Страницы `/dashboard` и `/admin` доступны только после входа. Роль `admin` нужна для `/admin`.

## Как дорабатывать «серверный» код

Всё, что у вас в репозитории (включая `src/app/api/*`, `src/lib/*`), и есть серверный код: он выполняется на хостинге при каждом запросе.

**Вариант 1: правки в этом репозитории**

- Меняете код локально (или в Cursor).
- Делаете коммит и пуш в Git.
- Хостинг (Vercel, Netlify, VPS с CI и т.п.) собирает проект и деплоит новую версию.

**Вариант 2: правки прямо на хостинге**

- На VPS: заходите по SSH, правите файлы в папке проекта, перезапускаете приложение (например, `pm2 restart all`).
- На Vercel/Netlify: правки обычно делают в Git; деплой идёт из репозитория.

Имеет смысл хранить все изменения в Git и деплоить с него, чтобы не потерять правки и иметь историю.

## Добавление агентов как пользователей

Сейчас первый пользователь создаётся через `/setup` и имеет роль `admin`. Чтобы агенты входили в панель:

1. В админке можно добавить API «добавить пользователя-агента» (логин + пароль + привязка к `agentId` из `agents.json`).
2. Либо вручную дописать запись в `src/data/users.json` (поля: `id`, `login`, `passwordHash`, `role: "agent"`, `name`, `agentId`). Хеш пароля можно получить, вызвав один раз API или скрипт с `hashPassword` из `src/lib/auth.ts`.

После этого агент входит через `/login` теми же учётными данными и получает доступ к `/dashboard`.
